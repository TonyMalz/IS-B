<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Video on Demand</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>

<header id="header">
    <input id="search" type="search" results value="" placeholder="Find...">

    <ul id="mainNav" class="tabs mainTabs">
      <li class="tab active" data-target="#page1"> <span>Movies</span>
        <!-- <button type="button" class="close">×</button> -->
      </li>
      <li class="tab" data-target="#page2"> <span>Series</span>
        <!-- <button type="button" class="close">×</button> -->
      </li>
      <li class="tab" data-target="#page3"> <span>Kids</span>
        <!-- <button type="button" class="close">×</button> -->
      </li>
    </ul>
</header>

<div id="first"></div>
<div id="main">


</div>

<footer></footer>

<!--JS includes-->
<script src='ftscroller-master/lib/ftscroller.js'></script>
<script src="chrometabs/chrometab.js"></script> 
<!-- JS templates -->
<script id="template" type="template">
<div class="categoryRow">
    <ul class="tabsCat">
        <li class="tab" draggable="true"> <span>{categoryName}</span>
            <button type="button" class="close closeAdd">+</button>
        </li>
    </ul>
    <div id="scroll{id}" class='scrollable'>
        <div class='sectionwrapper'>
            {movies}
        </div>

    </div>
    <a id="showmore{id}" data-close="0" data-translate="0" class="showmore">V &nbsp;&nbsp;Show more</a>
</div>
</script>
<script id="movieTemplate" type="template">
            <section>
                <figure>
                    <img src="new/m-{i}.jpg">
                    <figcaption>

                        <h3>>  &nbsp; Watch</h3>
                        <p>Test text blalbal blab sdsd sdsd
                         sdsd
                        </p>
                        <p><a href="#">show more</a></p>
                    </figcaption>
                </figure>
                <span class="stars">
                    <img src="images/stars-{stars}.gif">
                </span>
            </section>
</script>

<!-- JS -->
<script>
(function() {
    var Viewer = {
        template:       document.getElementById('template').text.trim(),
        movieTemplate:  document.getElementById('movieTemplate').text.trim(),
        movieCategories: ['New Releases','Popular','Recommended','Action','Comedy','Drama','Fantasy','Sci-Fi','Thriller','Horror','Romantic'],

        init: function(){
            this.applyMovieTemplate(1,72);
        },

        applyMovieTemplate: function(pageRepeat, moviesPerCat){
            var temp='';
            var id=0;

            var catTemp="";

            //build up array
            var imgs = [];
            for (var i = 0; i < moviesPerCat; i++) {
                imgs.push(i);
            }
            
            


            var page=0;
            while (page++<pageRepeat){
                for (var i = 0; i < this.movieCategories.length ; i++) {

                    catTemp = '';
                    //shuffle array
                    imgs.sort(function() {
                      return .5 - Math.random();
                    });
                    for (var j = imgs.length - 1; j >= 0; j--) {
                        catTemp += this.movieTemplate.replace(/{i}/,imgs[j])
                                                     .replace(/{stars}/,imgs[j]%25);
                    }
                    temp += this.template.replace(/{categoryName}/, this.movieCategories[i])
                                         .replace(/{id}/g,id++)
                                         .replace(/{movies}/,catTemp);
                    
                };
            }
            document.getElementById('main').innerHTML=temp;
            this.initScrolls(id);
        },

        initScrolls: function (maxId){
            for (var id = 0; id < maxId; id++) {
                new FTScroller(document.getElementById('scroll'+id), {scrollingY: false,snapping: false,scrollbars: false, disabledInputMethods:{scroll: true}});
            }
        }

    };

    Viewer.init();

})();



// make tabs sortable
$('#mainNav').chrometab();




function addTabToMainNav(tabName){
    var activeMainTab = document.querySelector('.active span');
    var activeMainTabName = activeMainTab ? '<i>('+activeMainTab.innerText+')</i>' : '';
    // console.log(activeMainTabName);
    document.getElementById('mainNav').innerHTML += '<li class="tab" data-target="#page5"> <span>'+tabName+'</span>' + activeMainTabName + '<button type="button" class="close">×</button></li>';
    registerCloseBtnEvent();
    $('#mainNav').chrometab();

}

//close buttons
function registerCloseBtnEvent(){
    [].forEach.call(document.querySelectorAll('#mainNav li button'), function(item) {
            item.addEventListener("click", function (e){
            // console.log(item);
            item.parentNode.remove();
            $('#mainNav').chrometab();
            e.preventDefault();
            },false);
        });
}

// drag and drop on header / main navigation
var header = document.getElementById('header');
header.addEventListener("dragover" , function(e){
    // console.log(e);
    e.preventDefault();
});
header.addEventListener("drop" , function(e){
    // console.log(e);
    e.preventDefault();
    var tabName = e.dataTransfer.getData("text");
    addTabToMainNav(tabName);

});

// init category tabs
[].forEach.call(document.querySelectorAll('.tabsCat li'), function(item) {
    
    //drag & drop behavior
    item.addEventListener("dragstart" , function(ev){
        // ev.dataTransfer.setData("text", ev.target.id);
        ev.dataTransfer.setData("text", ev.target.childNodes[1].innerText);
    });
    
    //add tab to main nav by clicking on + button 
    item.addEventListener("click", function (e){
        var tabName = item.childNodes[1].innerText;
        addTabToMainNav(tabName);

        //re-register click events
        registerCloseBtnEvent();
        e.preventDefault();
        
    },false);
});



//show more links
[].forEach.call(document.querySelectorAll('.showmore'), function(item) {
    
    //drag & drop behavior
    item.addEventListener("click" , function(e){
        e.preventDefault();
        var containerId= e.target.id.replace(/showmore/,'');
        var scrollContainer = document.getElementById('scroll'+containerId);
        // console.log(e.target.dataset.close);
        
        //expanding
        if (scrollContainer && e.target.dataset.close == 0) {
            
            var scroll = scrollContainer.querySelector('.ftscroller_x');

            //save scroll position width if set
            if (scroll.style.transform) {
                e.target.dataset.translate = scroll.style.transform;
                // console.log(scroll.style.transform);
            }
            //reset scroll position
            scroll.style.transform="translate3d(0,0,0)";
            //unwrap container
            scrollContainer.style.whiteSpace='initial';
            e.target.innerHTML='x &nbsp;&nbsp;Show less';
            e.target.dataset.close=1;

        } 
        // closing 
        else if (scrollContainer && e.target.dataset.close == 1) {
            var scroll = scrollContainer.querySelector('.ftscroller_x');
            
            //restore scroll position if set
            if (e.target.dataset.translate != 0 && scroll) {
                scroll.style.transform = e.target.dataset.translate;
                // console.log(scroll.style.transform);
            }
            e.target.dataset.translate=0;
            scrollContainer.style.whiteSpace='nowrap';
            e.target.innerHTML='V &nbsp;&nbsp;Show more';
            e.target.dataset.close=0;
            // scrollContainer.scrollIntoView();
            window.scrollTo(0,scrollContainer.offsetTop - 150);
        }
        
        // console.log(containerId);
        // console.log(scrollContainer);
    },false);    

});


if (false) {

[].forEach.call(document.querySelectorAll('.ftscroller_x'), function(item) {
    item.style.transform="translate3d(-"+Math.floor(Math.random() * 190)+"px,0,0)"
});
};
</script>
</body>
</html>