<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Video on Demand</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>

<header id="header">
    <input id="search" type="search" results value="" placeholder="Find...">

    <ul id="mainNav" class="tabs mainTabs">
      <li class="tab active" data-target="#page1"> <span>Movies</span>
        <!-- <button type="button" class="close">×</button> -->
      </li>
      <li class="tab" data-target="#page2"> <span>Series</span>
        <!-- <button type="button" class="close">×</button> -->
      </li>
      <li class="tab" data-target="#page3"> <span>Kids</span>
        <!-- <button type="button" class="close">×</button> -->
      </li>
    </ul>
</header>

<div id="first"></div>
<div id="main">


</div>
<footer></footer>

<!--JS includes-->
<script src='ftscroller-master/lib/ftscroller.js'></script>
<script src="chrometabs/chrometab.js"></script> 
<!-- JS templates -->
<script id="template" type="template">
    <ul class="tabsCat">
        <li class="tab" draggable="true"> <span>{categoryName}</span>
            <button type="button" class="close closeAdd">+</button>
        </li>
    </ul>
    <div id="scroll{id}" class='scrollable'>
        <div class='sectionwrapper'>
            {movies}
        </div>
    </div>

</script>
<script id="movieTemplate" type="template">
            <section><div></div></section>
</script>

<!-- JS -->
<script>
(function() {
    var Viewer = {
        template:       document.getElementById('template').text.trim(),
        movieTemplate:  document.getElementById('movieTemplate').text.trim(),
        movieCategories: ['New Releases','Popular','Recommended','Action','Comedy','Drama','Fantasy','Sci-Fi','Thriller','Horror','Romantic'],

        init: function(){
            this.applyMovieTemplate(3,30);
        },

        applyMovieTemplate: function(pageRepeat, moviesPerCat){
            var temp='';
            var id=0;

            var cat=0;
            var catTemp="";
            while(cat++ < moviesPerCat){
                catTemp += this.movieTemplate;
            }

            var page=0;
            while (page++<pageRepeat){
                for (var i = 0; i < this.movieCategories.length ; i++) {
                    temp += this.template.replace(/{categoryName}/, this.movieCategories[i])
                                         .replace(/{id}/,id++)
                                         .replace(/{movies}/,catTemp);
                    
                };
            }
            document.getElementById('main').innerHTML=temp;
            this.initScrolls(id);
        },

        initScrolls: function (maxId){
            for (var id = 0; id < maxId; id++) {
                new FTScroller(document.getElementById('scroll'+id), {scrollingY: false,snapping: false,scrollbars: false, disabledInputMethods:{scroll: true}});
            }
        }

    };

    Viewer.init();

})();

// make tabs sortable
$('#mainNav').chrometab();


function addTabToMainNav(tabName){
    var activeMainTab = document.querySelector('.active span');
    var activeMainTabName = activeMainTab ? '<i>('+activeMainTab.innerText+')</i>' : '';
    // console.log(activeMainTabName);
    document.getElementById('mainNav').innerHTML += '<li class="tab" data-target="#page5"> <span>'+tabName+'</span>' + activeMainTabName + '<button type="button" class="close">×</button></li>';
    registerCloseBtnEvent();
    $('#mainNav').chrometab();

}

//close buttons
function registerCloseBtnEvent(){
    [].forEach.call(document.querySelectorAll('#mainNav li button'), function(item) {
            item.addEventListener("click", function (e){
            // console.log(item);
            item.parentNode.remove();
            $('#mainNav').chrometab();
            e.preventDefault();
            },false);
        });
}

// drag and drop on header / main navigation
var header = document.getElementById('header');
header.addEventListener("dragover" , function(e){
    // console.log(e);
    e.preventDefault();
});
header.addEventListener("drop" , function(e){
    // console.log(e);
    e.preventDefault();
    var tabName = e.dataTransfer.getData("text");
    addTabToMainNav(tabName);

});

// init category tabs
[].forEach.call(document.querySelectorAll('.tabsCat li'), function(item) {
    
    //drag & drop behavior
    item.addEventListener("dragstart" , function(ev){
        // ev.dataTransfer.setData("text", ev.target.id);
        ev.dataTransfer.setData("text", ev.target.childNodes[1].innerText);
    });
    
    //add tab to main nav by clicking on + button 
    item.addEventListener("click", function (e){
        var tabName = item.childNodes[1].innerText;
        addTabToMainNav(tabName);

        //re-register click events
        registerCloseBtnEvent();
        e.preventDefault();
        
    },false);
});


if (false) {

[].forEach.call(document.querySelectorAll('.ftscroller_x'), function(item) {
    item.style.transform="translate3d(-"+Math.floor(Math.random() * 190)+"px,0,0)"
});
};
</script>
</body>
</html>